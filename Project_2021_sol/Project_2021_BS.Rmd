---
title: "Project 2021"
author: "Berthony Sully & Landy Clément"
date: "9/16/2021"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Abcd
### 1.Proposer un code permettant de regrouper les données contenues dans movies.zip dans un seul et même data.frame.
```{r, message = FALSE} 
#Attach the necessary libraries
library(dplyr)
library(readr)

#1. Capture the raw pat of the zip folder
raw_path <- "C:/Users/bsully/OneDrive - Université Paris 1 Panthéon-Sorbonne/Bureau/Project_2021_sol/movies.zip"

#2. unzip the folder
data <- unzip(raw_path, files = NULL, list = F, exdir = "movie_unzip")

#3. Capture the new path to the folder that contains the datasets
path_ <- "C:/Users/bsully/OneDrive - Université Paris 1 Panthéon-Sorbonne/Bureau/Project_2021_sol/movie_unzip"

#4. Create a function to merge all the datasets
merge_df = function(path_to_folder){

  #capture the names of the files in the folder
  list_name_file = list.files(path = path_to_folder, full.names = T)
  
  #read all the files in the folder
  data_list = lapply(list_name_file, function(x){
    read.csv(file = x, header = TRUE)
    }) #x --> names of the files to read (in this case 'list_name_file')
  
  #combine the datasets with the reduce function 
  #after merging them two by two (merge function)
  Reduce(function(x, y){merge(x, y, all = T)}, data_list)
}

#5. Store the complete merged dataset
complete_data <- merge_df(path_)
```

### 2. Observer pour chaque variable, le nombre et la proportion de valeurs manquantes.

```{r, message=FALSE}
# Number of missing values
na_num <- complete_data %>% 
  summarise_all(funs(sum(is.na(.))))

print.table(na_num)
```
```{r}
#  Presentage of missng values
na_percent <- round(na_num/sum(is.na(complete_data) * 100), 3)

print.table(na_percent)
```

### 3. Représenter graphiquement la distribution de la durée des films

```{r}
library(tidyverse)
complete_data$duration <- as.numeric(complete_data$duration)
ggplot(complete_data, aes(x = duration)) +
  geom_histogram(fill = 'steelblue', binwidth = 50, alpha = 1)  + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(title = 'Représentation graphique de la durée des films', x = 'Durée', y = 'Effectif') +
  scale_y_continuous(n.breaks = 15) +
  scale_x_continuous(n.breaks = 20)
```
### 4. Compter le nombre de films dans lesquels la langue française apparait.

```{r}
library(stringr)
complete_data %>% 
  filter(str_detect(language, "French|.French.")) %>% 
  select(language) %>% 
  count() %>% 
  paste(.,'films sont disponibles en francais')
```


### 5. Créer une variable permettant de discrétiser la variable year par décennie (ex : 1975 => Entre 1970 et 1980, 1995 => Entre 1990 et 2000, 2001 => Entre 2000 et 2010…)

```{r}
paste("La variable Year est de type :", typeof(complete_data$year))
```
#### On peut essayer de voir les valeurs uniques de year pour avoir une plus nette explication
```{r}
unique(complete_data$year)
```
#### La valeur "TV Movie 2019" semble être le probleme. Pour cela, étant donné qu'on connait le contexe on peut remplacer cette valeur par "2019" et convertir la variable au type 'numeric.


```{r, message=FALSE, warning=FALSE}
# Select year column
complete_data$year <- complete_data$year %>% 
  #convert as numeric type
  as.numeric %>% 
  #replace the NA value with 2019
  replace_na(., 2019)
#show unique value of recently created year column
unique(complete_data$year)
```

```{r}
#creation of the "decade variable"
complete_data$decade <- cut(complete_data$year, 
                            breaks = c(seq(min(complete_data$year), 
                                           max(complete_data$year) + 10, 10)),
                            labels = c("1894 - 1903",
                                       "1904 - 1913",
                                       "1914 - 1923",
                                       "1924 - 1933",
                                       "1934 - 1943",
                                       "1944 - 1953",
                                       "1954 - 1963",
                                       "1964 - 1973",
                                       "1974 - 1983",
                                       "1984 - 1993",
                                       "1994 - 2003",
                                       "2004 - 2013",
                                       "2014 - 2023"),
                            right = F,
                            include.lowest = T)

#randomly select some line in year and decade columns to verify the results
complete_data %>% 
  select(year, decade)%>% 
  sample_n(50)
```

### 6. Proposer une représentation graphique permettant d’observer pour chaque décennie, le nombre et la proportion de films dans lesquels la langue française apparait.


```{r}

complete_data %>%
  select(language, decade) %>% 
  group_by(decade) %>% 
  count(french = str_detect(language, "French|.French.")) %>% 
  mutate(p = n / sum(n)) %>% 
  filter(french == T) %>%
  ggplot(aes(y = decade, label = p)) + 
  geom_bar(aes(weight = n), fill = "steelblue") +
  theme(plot.title = element_text(hjust = .5)) + 
  labs(title = "Représentation de la quantité de films \n dans lesquels la langue française apparait par décenie",
       x = "Effectif", y = "Décennie")
  # geom_text(aes(label=decade), hjust=1.6, color="white", size=3.5)
# label des bars a ajouter
```

```{r}

complete_data %>%
  select(language, decade) %>% 
  group_by(decade) %>% 
  count(french = str_detect(language, "French|.French.")) %>% 
  mutate(p = n / sum(n)) %>% 
  filter(french == T) %>%
  ggplot(aes(y = decade, label = p)) + 
  geom_bar(aes(weight = p), fill = "steelblue")+
  scale_x_continuous(labels = scales::percent) +
  theme(plot.title = element_text(hjust = .5)) + 
  labs(title = "Représentation de la proportion de films \n dans lesquels la langue française apparait par décenie",x = "Pourcentage", y = "Décennie")
```
### 7. Pour toutes les variables de la forme « avg_vote ». Calculer la moyenne, la médiane, l’écart type, la mad (median absolute deviation), le coefficient de variation, la valeur maximum et la valeur minimum. Représentez graphiquement ces résultats.

```{r}

```






```{r}
names(complete_data)
```


```{r}
unique(complete_data$year)
```


